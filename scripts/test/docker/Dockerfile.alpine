# Alpine Linux minimal test environment for install scripts
FROM alpine:latest

# Install dependencies for testing
RUN apk add --no-cache \
    curl \
    wget \
    tar \
    gzip \
    bash \
    zsh \
    ca-certificates \
    jq \
    shadow \
    coreutils

# Create test users with different shells
RUN adduser -D -s /bin/bash testuser && \
    adduser -D -s /bin/zsh zshuser && \
    adduser -D -s /bin/sh shuser

# Create directory structure
RUN mkdir -p /usr/local/bin /opt/local/bin && \
    chmod 755 /usr/local/bin /opt/local/bin

# Set up PATH for testing
ENV PATH="/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin"

# Copy test runner script (install scripts will be mounted at runtime)
COPY test-runner.sh /test/test-runner.sh

# Create test directory and make test runner executable
RUN chmod +x /test/test-runner.sh

# Set working directory
WORKDIR /test

# Default command runs test suite
CMD ["./test-runner.sh"]
