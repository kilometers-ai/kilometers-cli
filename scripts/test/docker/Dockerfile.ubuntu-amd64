# Ubuntu 22.04 x86_64 test environment for install scripts
FROM ubuntu:22.04

# Install dependencies for testing
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    tar \
    gzip \
    ca-certificates \
    bash \
    zsh \
    fish \
    jq \
    && rm -rf /var/lib/apt/lists/*

# Create test users with different privilege levels
RUN useradd -m -s /bin/bash testuser && \
    useradd -m -s /bin/zsh zshuser && \
    useradd -m -s /usr/bin/fish fishuser && \
    useradd -m -s /bin/bash nonetuser

# Create directory structure that mirrors typical Linux setups
RUN mkdir -p /usr/local/bin /opt/local/bin && \
    chmod 755 /usr/local/bin /opt/local/bin

# Set up PATH for different scenarios
ENV PATH="/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin"

# Copy test runner script (install scripts will be mounted at runtime)
COPY test-runner.sh /test/test-runner.sh

# Create test directory and make test runner executable
RUN chmod +x /test/test-runner.sh

# Set working directory
WORKDIR /test

# Default command runs test suite
CMD ["./test-runner.sh"]
